type: sections
max_columns: 4
title: H2D
path: h2d-dashboard
icon: ""
layout: {}
sections:
  - type: grid
    cards:
      - type: vertical-stack
        cards:
          - type: custom:mushroom-title-card
            title: Bambu H2D
            subtitle: |
              {{ states('sensor.h2d_current_stage') }}
          - type: conditional
            conditions:
              - condition: state
                entity: sensor.h2d_current_stage
                state_not: idle
              - condition: state
                entity: sensor.h2d_current_stage
                state_not: offline
            card:
              type: custom:mushroom-template-card
              primary: >-
                {{ state_attr('sensor.h2d_print_progress', 'current_file') |
                default('No file') }}
              secondary: >
                {{ states('sensor.h2d_print_progress') }}% • 

                {{ states('sensor.h2d_remaining_time') | replace('unknown',
                'Calculating...') }}
              icon: mdi:printer-3d-nozzle
              icon_color: blue
              tap_action:
                action: more-info
                entity: sensor.h2d_print_progress
              card_mod:
                style: |
                  ha-card {
                    --ha-card-background: rgba(var(--rgb-primary-color), 0.05);
                  }
          - type: conditional
            conditions:
              - condition: state
                entity: sensor.h2d_current_stage
                state_not: idle
              - condition: state
                entity: sensor.h2d_current_stage
                state_not: offline
            card:
              type: custom:mushroom-template-card
              primary: ""
              secondary: ""
              icon: ""
              card_mod:
                style: |
                  ha-card {
                    height: 10px;
                    background: linear-gradient(
                      to right,
                      var(--rgb-primary-color) {{ states('sensor.h2d_print_progress') | float }}%,
                      rgba(var(--rgb-primary-color), 0.1) {{ states('sensor.h2d_print_progress') | float }}%
                    );
                    border-radius: 12px;
                    margin: -8px 12px 8px 12px;
                  }
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: Nozzle
                secondary: |
                  {{ states('sensor.h2d_nozzle_temperature') }}°C
                  {% if states('sensor.h2d_nozzle_target_temperature') != '0' %}
                  → {{ states('sensor.h2d_nozzle_target_temperature') }}°C
                  {% endif %}
                icon: mdi:printer-3d-nozzle-heat
                icon_color: >
                  {% set temp = states('sensor.h2d_nozzle_temperature') |
                  float(0) %}

                  {% if temp > 200 %}
                    red
                  {% elif temp > 100 %}
                    orange
                  {% elif temp > 50 %}
                    yellow
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: more-info
                  entity: sensor.h2d_nozzle_temperature
              - type: custom:mushroom-template-card
                primary: Bed
                secondary: |
                  {{ states('sensor.h2d_bed_temperature') }}°C
                  {% if states('sensor.h2d_bed_target_temperature') != '0' %}
                  → {{ states('sensor.h2d_bed_target_temperature') }}°C
                  {% endif %}
                icon: mdi:printer-3d-nozzle-heat-outline
                icon_color: |
                  {% set temp = states('sensor.h2d_bed_temp') | float(0) %}
                  {% if temp > 80 %}
                    red
                  {% elif temp > 50 %}
                    orange
                  {% elif temp > 30 %}
                    yellow
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: more-info
                  entity: sensor.h2d_bed_temperature
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: Speed
                secondary: "{{ states('sensor.h2d_speed_profile') }}"
                icon: mdi:speedometer
                icon_color: |
                  {% set speed = states('sensor.h2d_speed_profile') %}
                  {% if speed == 'sport' %}
                    red
                  {% elif speed == 'standard' %}
                    blue
                  {% elif speed == 'silent' %}
                    green
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: more-info
                  entity: sensor.h2d_speed_profile
              - type: custom:mushroom-template-card
                primary: Fan
                secondary: "{{ states('sensor.h2d_aux_fan_speed') }}%"
                icon: mdi:fan
                icon_color: |
                  {% set fan = states('sensor.h2d_aux_fan_speed') | float(0) %}
                  {% if fan > 75 %}
                    blue
                  {% elif fan > 25 %}
                    light-blue
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: more-info
                  entity: sensor.h2d_aux_fan_speed
          - type: conditional
            conditions:
              - condition: state
                entity: sensor.h2d_current_stage
                state_not: idle
              - condition: state
                entity: sensor.h2d_current_stage
                state_not: offline
            card:
              type: horizontal-stack
              cards:
                - type: custom:mushroom-template-card
                  primary: ""
                  secondary: |
                    {% if is_state('sensor.h2d_current_stage', 'printing') %}
                      Pause
                    {% else %}
                      Resume
                    {% endif %}
                  icon: |
                    {% if is_state('sensor.h2d_current_stage', 'printing') %}
                      mdi:pause
                    {% else %}
                      mdi:play
                    {% endif %}
                  icon_color: |
                    {% if is_state('sensor.h2d_current_stage', 'printing') %}
                      orange
                    {% else %}
                      green
                    {% endif %}
                  tap_action:
                    action: call-service
                    service: |
                      {% if is_state('sensor.h2d_current_stage', 'printing') %}
                        button.press
                      {% else %}
                        button.press
                      {% endif %}
                    service_data:
                      entity_id: >
                        {% if is_state('sensor.h2d_current_stage', 'printing')
                        %}
                          button.h2d_pause
                        {% else %}
                          button.h2d_resume
                        {% endif %}
                - type: custom:mushroom-template-card
                  primary: ""
                  secondary: Stop
                  icon: mdi:stop
                  icon_color: red
                  tap_action:
                    action: call-service
                    service: button.press
                    service_data:
                      entity_id: button.h2d_stop
                  hold_action:
                    action: none
                  double_tap_action:
                    action: none
          - type: conditional
            conditions:
              - condition: state
                entity: camera.h2d_camera
                state_not: unavailable
            card:
              type: picture-entity
              entity: camera.h2d_camera
              camera_view: live
              show_state: false
              show_name: false
              aspect_ratio: "16:9"
              tap_action:
                action: more-info
      - show_name: true
        show_icon: true
        type: button
        entity: light.h2d_chamber_light
        grid_options:
          rows: 2
          columns: 3
        name:
          type: entity
        show_state: false
  - type: grid
    cards:
      - type: heading
        heading: AMS 2 Pro
        heading_style: title
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-template-card
            entity: sensor.h2d_ams_1_tray_1
            primary: "{{ state_attr('sensor.h2d_ams_1_tray_1', 'type') }}"
            secondary: "{{ state_attr('sensor.h2d_ams_1_tray_1', 'name') }}"
            icon: |-
              {% if states('sensor.h2d_ams_1_tray_1') != 'empty' %}
                fapro:filament-2
              {% else %}
                mdi:tray
              {% endif %}
            icon_color: >-
              {% set color = state_attr('sensor.h2d_ams_1_tray_1', 'color') %}
              {% if color %}
                {{ color }}
              {% else %}
                grey
              {% endif %}
            badge_icon: |-
              {% if is_state_attr('sensor.h2d_ams_1_tray_1', 'active', true) %}
                mdi:play
              {% endif %}
            badge_color: amber
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.h2d_ams_1_tray_2
            primary: "{{ state_attr('sensor.h2d_ams_1_tray_2', 'type') }}"
            secondary: "{{ state_attr('sensor.h2d_ams_1_tray_2', 'name') }}"
            icon: |-
              {% if states('sensor.h2d_ams_1_tray_2') != 'empty' %}
                fapro:filament-2
              {% else %}
                mdi:tray
              {% endif %}
            icon_color: >-
              {% set color = state_attr('sensor.h2d_ams_1_tray_2', 'color') %}
              {% if color %}
                {{ color }}
              {% else %}
                grey
              {% endif %}
            badge_icon: |-
              {% if is_state_attr('sensor.h2d_ams_1_tray_2', 'active', true) %}
                mdi:play
              {% endif %}
            badge_color: amber
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.h2d_ams_1_tray_3
            primary: "{{ state_attr('sensor.h2d_ams_1_tray_3', 'type') }}"
            secondary: "{{ state_attr('sensor.h2d_ams_1_tray_3', 'name') }}"
            icon: |-
              {% if states('sensor.h2d_ams_1_tray_3') != 'empty' %}
                fapro:filament-2
              {% else %}
                mdi:tray
              {% endif %}
            icon_color: >-
              {% set color = state_attr('sensor.h2d_ams_1_tray_3', 'color') %}
              {% if color %}
                {{ color }}
              {% else %}
                grey
              {% endif %}
            badge_icon: |-
              {% if is_state_attr('sensor.h2d_ams_1_tray_3', 'active', true) %}
                mdi:play
              {% endif %}
            badge_color: amber
            tap_action:
              action: more-info
          - type: custom:mushroom-template-card
            entity: sensor.h2d_ams_1_tray_4
            primary: "{{ state_attr('sensor.h2d_ams_1_tray_4', 'type') }}"
            secondary: "{{ state_attr('sensor.h2d_ams_1_tray_4', 'name') }}"
            icon: |-
              {% if states('sensor.h2d_ams_1_tray_4') != 'empty' %}
                fapro:filament-2
              {% else %}
                mdi:tray
              {% endif %}
            icon_color: >-
              {% set color = state_attr('sensor.h2d_ams_1_tray_4', 'color') %}
              {% if color %}
                {{ color }}
              {% else %}
                grey
              {% endif %}
            badge_icon: |-
              {% if is_state_attr('sensor.h2d_ams_1_tray_4', 'active', true) %}
                mdi:play
              {% endif %}
            badge_color: amber
            tap_action:
              action: more-info
visible:
  - user: 077f34bf7da0455e9c68f70286194655
cards: []
